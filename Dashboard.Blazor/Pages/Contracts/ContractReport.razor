@attribute [Authorize]
@inherits BasePage

<MudDialog>
    <DialogContent>
        <div id="unique_id_scroll_section" class="w-100 d-flex flex-column align-items-center py-5" style="height: 60vh;overflow: auto;">
            @if (contract is null)
            {
                <FormLoadingSpinner IsBigForm="true" />
            }
            else
            {
                <div class="border rounded-lg border-gray-600" style="width:992px;background-color:white !important">
                    <div id="Report" class="px-8 py-5 h-100">
                        <div dir="rtl" style="direction:rtl;border-left: solid 30px #00a2e5;background-image: url(/images/LogoOpacity.png);background-repeat: no-repeat;background-size: 400px 400px;background-position: center;" class="d-flex flex-column h-100">
                            <div>
                                <div class="row align-items-center justify-content-between mb-20">
                                    <div class="col-auto px-5">
                                        <div class="d-flex flex-column align-items-center">
                                            <p class="fs-1 fw-bold text-primary text-center">
                                                شركة المكافحة المتميزة<br /><span class="text-success">للتشغيل والصيانة</span>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-auto px-5">
                                        <MudImage Src="/images/Logo.png" Width="150" />
                                    </div>
                                </div>
                                <div class="text-center mb-10">
                                    <div style="width: fit-content;" class="fs-2 fw-bold border border-gray-600 border-4 rounded-lg p-3 m-auto">
                                        @contract.Title
                                    </div>
                                </div>
                                <div class="h5">
                                    <p>التاريخ: @contract.CreatedAt.ToShortDateString()</p>
                                </div>
                                <div class="h5">
                                    <p>بوجب هذا العقد قد تم الإتفاق بين كل من:</p>
                                    <p>السادة/ @contract.FirstParty . ويشار إليها في العقد بوصفها الطرف الأول . سجل تجاري: @contract.FpCommercialRegistrationNo</p>
                                    <p>ويمثل الطرف الأول في هذا التعاقد @contract.FpExecutiveOfficer . بصفته @contract.FpExecutiveOfficerJob</p>
                                    <p>البريد الإلكتروني المعتمد لدى للطرف الأول: @contract.FpMail</p>
                                    <p>السادة/ @contract.SecondParty . ويشار إليها في العقد بوصفها الطرف الثاني . سجل تجاري: @contract.SpCommercialRegistrationNo </p>
                                    <p>ويمثل الطرف الثاني في هذا التعاقد  @contract.SpExecutiveOfficer . بصفته @contract.SpExecutiveOfficerJob</p>
                                    <p>البريد الإلكتروني المعتمد لدى للطرف الأول: @contract.SpMail</p>
                                </div>
                                <div class="h3 mt-5 fw-bold text-center">
                                    <p>التمهيد</p>
                                </div>
                                <div class="h5">
                                    <p>@contract.ContractIntro</p>
                                </div>
                                @foreach (var term in contract.Terms)
                                {
                                    <div class="h5">
                                        <p><span class="fw-bold text-decoration-underline">@term.Title: </span>@term.Term</p>
                                    </div>
                                }        
                                <div class="h3 mt-5 fw-bold text-center">
                                    <p>ملاحظات</p>
                                </div>
                                <div class="h5">
                                    <p>@contract.Notes</p>
                                </div>
                                <div style="margin-bottom:300px" class="row align-items-center justify-content-around mt-20">
                                    <div class="col-auto">
                                        <div class="d-flex flex-column align-items-center">
                                            <p class="fs-4 fw-bold">
                                                الطرف الأول
                                            </p>
                                            <p class="fs-4 fw-bold">
                                                @contract.FirstParty
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <div class="d-flex flex-column align-items-center">
                                            <p class="fs-4 fw-bold">
                                                الطرف الثاني
                                            </p>
                                            <p class="fs-4 fw-bold">
                                                @contract.SecondParty
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-around mt-10 mb-5">
                                    <a class="align-items-center text-gray-800 text-hover-primary">
                                        <i class="ki-duotone ki-phone fs-4 me-1">
                                            <span class="path1"></span>
                                            <span class="path2"></span>
                                        </i>
                                        +966 567 780 260
                                    </a>
                                    <a class="align-items-center text-gray-800 text-hover-primary">
                                        <i class="ki-duotone ki-sms fs-4 me-1">
                                            <span class="path1"></span>
                                            <span class="path2"></span>
                                        </i>
                                        Info@pestsweepy.com
                                    </a>
                                    <a class="align-items-center text-gray-800 text-hover-primary">
                                        <i class="ki-duotone ki-tablet fs-4 me-1">
                                            <span class="path1"></span>
                                            <span class="path2"></span>
                                            <span class="path3"></span>
                                        </i>
                                        920013270
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
            <MudScrollToTop  TopOffset="100"
                            Selector="#unique_id_scroll_section"
                            VisibleCssClass="visible absolute me-10"
                            HiddenCssClass="invisible">
                <MudFab Color="Color.Primary" IconSize="Size.Large" StartIcon="@Icons.Material.Filled.KeyboardDoubleArrowUp" />
            </MudScrollToTop>
        </div>
    </DialogContent>
    <DialogActions>
        <div class="w-100 text-center">
            <button @onclick="PrintReport" class="btn btn-lg btn-success m-5">
                @languageContainer.Keys["Print"]
            </button>
        </div>
    </DialogActions>
</MudDialog>


@code {
    [Inject] IJSRuntime JSRuntime { get; set; } = default!;
    [Parameter][EditorRequired] public int Id { get; set; }
    [CascadingParameter] MudDialogInstance MudDialog { get; set; } = default!;


    private ContractDto? contract;

    protected override async Task OnParametersSetAsync()
    {
        contract = await GetByIdAsync<ContractDto>($"Contracts/{Id}");
    }

    void Cancel() => MudDialog.Cancel();

    private async Task PrintReport()
    {;

        await JSRuntime.InvokeVoidAsync("DownloadPdf");
    }
}
