@page "/Services"
@attribute [Authorize(Roles = Roles.AdminRole)]
@inherits BasePage

<BrowserViewportObserver TableHeightChanged="TableHeightChanged" />

@if (CategoryId is null)
{
    <PageTitle>@languageContainer.Keys["Services"]</PageTitle>
    <MudBreadcrumbs Items="breadcrumbItems"></MudBreadcrumbs>
}

<MudCard Elevation="@(CategoryId is null? 25 : 0)">
    <MudCardContent>
        <MudDataGrid T="ServiceDto" Dense="true" Elevation="0" FixedHeader="true" Height="@($"{tableHight}px")"
                     Loading="@(isLoading)" LoadingProgressColor="Color.Info" Filterable="true"
                     Items="services" Hover="true" SortMode="SortMode.Single" QuickFilter="@FilterFunc">

            <ToolBarContent>
                <div class="d-flex justify-content-between flex-column align-items-center flex-md-row w-100">
                    <div class="w-md-25 w-100">
                        <div class="d-flex align-items-center">
                            <MudAvatar Rounded="true" Color="Color.Info">
                                <MudIcon Icon="@Icons.Material.Filled.Handyman" />
                            </MudAvatar>
                            <MudText Class="mx-3" Typo="Typo.h5">@languageContainer.Keys["Services"]</MudText>
                            <MudIconButton OnClick="() => OpenForm(formUri)" Icon="@Icons.Material.Filled.Add" Color="Color.Success"></MudIconButton>
                        </div>
                    </div>
                    <div class="w-md-50 w-100">
                        <MudTextField @bind-Value="searchString" Adornment="Adornment.Start" Class="mt-0 mb-5" Immediate="true"
                                      Placeholder=@($"{languageContainer.Keys["Search For"]} User Id, Type, Table Name, Date")
                                      AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" />
                    </div>
                </div>
            </ToolBarContent>

            <NoRecordsContent>
                <NoDataToDisply />
            </NoRecordsContent>

            <Columns>
                <TemplateColumn Context="service" SortBy="new Func<ServiceDto, object>(x=>x.NameEn)">
                    <HeaderTemplate>
                        <MudText>Service</MudText>
                    </HeaderTemplate>
                    <CellTemplate>
                        <div class="d-flex align-items-center">
                            <MudAvatar Class="cursor-all-scroll" @onclick="() => ShowImagePreview(imageUrl + service.Item!.Image)" Rounded="true" Size="Size.Large">
                                <MudImage Src="@(imageUrl + service.Item!.Image)" />
                            </MudAvatar>
                            <div class="mx-3">
                                <MudText>@service.Item!.NameEn</MudText>
                            </div>
                        </div>
                    </CellTemplate>
                </TemplateColumn>

                <TemplateColumn Context="service">
                    <HeaderTemplate>
                        <MudText Class="w-100">Duration</MudText>
                    </HeaderTemplate>
                    <CellTemplate>
                        <MudText>@HandelDuration((int)service.Item.DurationInMinutes!)</MudText>
                    </CellTemplate>
                </TemplateColumn>

                <TemplateColumn Context="service">
                    <HeaderTemplate>
                        <MudText Class="w-100">Price</MudText>
                    </HeaderTemplate>
                    <CellTemplate>
                        <MudText>@service.Item!.Price?.Amount @service.Item!.Price?.Currency?.Symbol</MudText>
                    </CellTemplate>
                </TemplateColumn>

                <TemplateColumn CellStyle="width:150px" SortBy="new Func<ServiceDto, object>(x=>x.OrderIndex)" Context="service" HeaderClass="text-center" CellClass="text-center" Filterable="false">
                    <HeaderTemplate>
                        <MudText Class="w-100">Order</MudText>
                    </HeaderTemplate>
                    <CellTemplate>
                        <MudText Class="w-100">@(service.Item!.OrderIndex is not null ? $"#{service.Item!.OrderIndex}" : string.Empty)</MudText>
                        </CellTemplate>
                </TemplateColumn>

                <TemplateColumn CellStyle="width:250px" CellClass="text-center" Context="service" HeaderClass="text-center" Sortable="false" Filterable="false">
                    <HeaderTemplate>
                        <MudText Class="w-100">Actions</MudText>
                    </HeaderTemplate>
                    <CellTemplate>
                            <TableButtons IsDisable="isDisable" EditClicked="() => OpenForm(formUri,service.Item!.Id)" DeleteClicked="() => Delete(service.Item!.Id)"
                                      DetailsClicked="() => OpenDetails(detailsUri,service.Item!.Id)" />
                    </CellTemplate>
                </TemplateColumn>
            </Columns>

            <PagerContent>
                <MudDataGridPager T="ServiceDto" />
            </PagerContent>
            </MudDataGrid>
        </MudCardContent>
    </MudCard>
